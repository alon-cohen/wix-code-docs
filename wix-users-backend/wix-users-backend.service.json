{ "name": "wix-users-backend",
  "mixes": [],
  "labels":
    [ "new" ],
  "location":
    { "filename": "users.js",
      "lineno": 76 },
  "docs":
    { "summary": "The wix-users-backend module contains functionality for working with your\n site's users from backend code.",
      "description":
        [ "There are three types of users:",
          "",
          " + Visitor - A user who is not logged into your site.",
          " + Member - A user who is logged into your site.",
          " + Admin - The owner of the site.",
          "",
          "",
          " To use the Users API, import `wixUsers` from the `wix-users-backend` module:",
          "",
          "   ``` javascript",
          "   import wixUsers from 'wix-users-backend';",
          "   ```" ],
      "links": [],
      "examples": [] },
  "properties":
    [ { "name": "currentUser",
        "labels": [],
        "get": true,
        "set": false,
        "type": "wix-users.User",
        "locations":
          [ { "filename": "users.js",
              "lineno": 310 } ],
        "docs":
          { "summary": "Gets the current user viewing the site.",
            "description":
              [ "Gets a [`User`](wix-users.User.html) object containing information about",
                " the user currently viewing the site." ],
            "links": [],
            "examples":
              [ { "title": "Get the current user's information",
                  "body":
                    [ "import wixUsers from 'wix-users-backend';",
                      "",
                      "// ...",
                      "",
                      "let user = wixUsers.currentUser;",
                      "",
                      "let userId = user.id;           // \"r5cme-6fem-485j-djre-4844c49\"",
                      "let isLoggedIn = user.loggedIn; // true",
                      "",
                      "user.getEmail()",
                      "  .then( (email) => {",
                      "    let userEmail = email;      // \"user@something.com\"",
                      "  } );",
                      "",
                      "user.getRoles()",
                      "  .then( (roles) => {",
                      "    let firstRole = roles[0];",
                      "    let roleName = firstRole.name;                // \"Role Name\"",
                      "    let roleDescription = firstRole.description;  // \"Role Description\"",
                      "  } );" ] } ] },
        "extra":
          {  } } ],
  "operations":
    [ { "name": "approveByEmail",
        "labels":
          [ "changed" ],
        "nameParams": [],
        "params":
          [ { "name": "email",
              "type": "string",
              "doc": "Email address of the user to approve." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "string" ] },
            "doc": "on fulfilled - A session token for logging in the approved user in client-side code.\non rejected - Error message." },
        "locations":
          [ { "filename": "users.js",
              "lineno": 226 } ],
        "docs":
          { "summary": "Approve a member whose status is `\"Pending\"` using an email address.",
            "description":
              [ "The `approveByEmail()` function returns a Promise that resolves to a",
                " session token when the specified user is approved.",
                "",
                " A member's status is `\"Pending\"` after you've called the [`register()`](#register)",
                " function when the site's membership policy is set to manual approval. To learn",
                " more about setting you site's membership approval policy, see",
                " [Editing Your Member Signup Settings](https://support.wix.com/en/article/editing-your-member-signup-settings).",
                "",
                " Pass the member's email address in the `email` parameter." ],
            "links": [],
            "examples":
              [ { "title": "Approve a pending member using an email address",
                  "body":
                    [ "import wixUsers from 'wix-users-backend';",
                      "",
                      "export function myBackendFunction(email) {",
                      "  wixUsers.approveByEmail(email)",
                      "    .then( (sessionToken) => {",
                      "      return {sessionToken, \"approved\": true};",
                      "    } );",
                      "    .catch( (error) => {",
                      "      return {\"approved\": false, \"reason\": error};",
                      "    } );",
                      "  }",
                      "}" ] } ] },
        "extra":
          {  } },
      { "name": "approveByToken",
        "labels":
          [ "changed" ],
        "nameParams": [],
        "params":
          [ { "name": "token",
              "type": "string",
              "doc": "Approval token returned by the `register()` function." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "string" ] },
            "doc": "on fulfilled - A session token for logging in the approved user in client-side code.\non rejected - Error message." },
        "locations":
          [ { "filename": "users.js",
              "lineno": 182 } ],
        "docs":
          { "summary": "Approve a member whose status is `\"Pending\"` using an approval token.",
            "description":
              [ "The `approveByToken()` function returns a Promise that resolves to a",
                " session token when the specified user is approved.",
                "",
                " A member's status is `\"Pending\"` after you've called the [`register()`](#register)",
                " function when the site's membership policy is set to manual approval. To learn",
                " more about setting you site's membership approval policy, see",
                " [Editing Your Member Signup Settings](https://support.wix.com/en/article/editing-your-member-signup-settings).",
                "",
                " Use the `approvalToken` parameter of the [`RegistrationResult`](#RegistrationResult)",
                " object returned from the [`register()`](#register) function when calling",
                " `approveByToken`." ],
            "links": [],
            "examples":
              [ { "title": "Approve a pending member using an approval token",
                  "body":
                    [ "import wixUsers from 'wix-users-backend';",
                      "",
                      "export function myBackendFunction(token) {",
                      "  wixUsers.approveByToken(token)",
                      "    .then( (sessionToken) => {",
                      "      return {sessionToken, \"approved\": true};",
                      "    } );",
                      "    .catch( (error) => {",
                      "      return {\"approved\": false, \"reason\": error};",
                      "    } );",
                      "  }",
                      "}" ] },
                { "title": "Register a user using a 3rd party for approval",
                  "body":
                    [ "/*******************************",
                      " * backend code - register.jsw *",
                      " *******************************/",
                      "import wixUsers from 'wix-users-backend';",
                      "import {approveBy3rdParty} from 'some-backend-module';",
                      "",
                      "export function doRegistration(email, password, firstName, lastName) {",
                      "  // call a 3rd party API to check if the user is approved",
                      "  return approveBy3rdParty(email, password)",
                      "    .then( (isApproved) => {",
                      "      // if approved by 3rd party",
                      "      if (isApproved) {",
                      "        // register the user",
                      "        return wixUsers.register(email, password, {",
                      "          \"contactInfo\": {",
                      "            \"firstName\": firstName,",
                      "            \"lastName\": lastName",
                      "          }",
                      "        } )",
                      "        // user is now registered and pending approval",
                      "        // approve the user",
                      "          .then( (result) => wixUsers.approveByToken(result.approvalToken) )",
                      "          // user is now active, but not logged in",
                      "          // return the session token to log in the user client-side",
                      "          .then( (sessionToken) => {",
                      "            return {sessionToken, \"approved\": true};",
                      "          } );",
                      "      }",
                      "      // if not approved by 3rd party",
                      "      else {",
                      "        return {\"approved\": false};",
                      "      }",
                      "    } )",
                      "}",
                      "",
                      "/********************",
                      " * client-side code *",
                      " ********************/",
                      "import wixUsers from 'wix-users';",
                      "import {doRegistration} from 'backend/register';",
                      "",
                      "// ...",
                      "",
                      "let email = // the user's email addresses",
                      "let password = // the user's password",
                      "let firstName = // the user's first name",
                      "let lastName = // the user's last name",
                      "",
                      "doRegistration(email, password, firstName, lastName)",
                      "  .then( (result) => {",
                      "    if (result.approved)",
                      "    // log the user in",
                      "      wixUsers.applySessionToken(result.sessionToken);",
                      "    else {",
                      "      console.log(\"Not approved!\");",
                      "    }",
                      "  } );" ] },
                { "title": "Register a user sending an email for confirmation",
                  "body":
                    [ "/*******************************",
                      " * backend code - register.jsw *",
                      " *******************************/",
                      "import wixUsers from 'wix-users-backend';",
                      "import {sendEmailUsing3rdParty} from 'some-backend-module';",
                      "",
                      "export function doRegistration(email, password, firstName, lastName) {",
                      "  // register the user",
                      "  return wixUsers.register(email, password, {",
                      "    \"contactInfo\": {",
                      "      \"firstName\": firstName,",
                      "      \"lastName\": lastName",
                      "    }",
                      "  } )",
                      "    .then( (results) => {",
                      "      // user is now registered and pending approval",
                      "      // send a registration verification email",
                      "      return sendEmailUsing3rdParty('verify-registration', email,{",
                      "        \"name\": firstName,",
                      "        \"verifyLink\": `http://domain.com/post-register?token=${approvalToken}`",
                      "      } );",
                      "    } );",
                      "}",
                      "",
                      "export function doApproval(token) {",
                      "  // approve the user",
                      "  return wixUsers.approveByToken(token)",
                      "  // user is now active, but not logged in",
                      "  // return the session token to log in the user client-side",
                      "    .then( (sessionToken) => {",
                      "      return {sessionToken, \"approved\": true};",
                      "    } )",
                      "    .catch( (error) => {",
                      "      return {\"approved\": false, \"reason\": error};",
                      "    } );",
                      "}",
                      "",
                      "/*********************************",
                      " * client-side registration code *",
                      " *********************************/",
                      "import wixUsers from 'wix-users';",
                      "import {doRegistration} from 'backend/register';",
                      "",
                      "// ...",
                      "",
                      "let email = // the user's email address",
                      "let password = // the user's password",
                      "let firstName = // the user's first name",
                      "let lastName = // the user's last name",
                      "",
                      "doRegistration(email, password, firstName, lastName)",
                      "  .then( () => {",
                      "    console.log(\"Confirmation email sent.\");",
                      "  } );",
                      "",
                      "/**************************************",
                      " * client-side post-registration code *",
                      " **************************************/",
                      "import wixLocation from 'wix-location';",
                      "import {doApproval} from 'backend/register';",
                      "",
                      "$w.onReady( () => {",
                      "  // get the token from the URL",
                      "  let token = wixLocation.query.token;",
                      "",
                      "  doAppoval(token)",
                      "    .then( (result) => {",
                      "      if (result.approved)",
                      "        // log the user in",
                      "        wixUsers.applySessionToken(result.sessionToken);",
                      "      else",
                      "        console.log(\"Not approved!\");",
                      "    } );",
                      "}" ] } ] },
        "extra":
          {  } },
      { "name": "blockByEmail",
        "labels":
          [ "changed" ],
        "nameParams": [],
        "params":
          [ { "name": "email",
              "type": "string",
              "doc": "Email address of the user to approve." } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "void" ] },
            "doc": "on fulfilled - When specified member is blocked.\non rejected - Error message." },
        "locations":
          [ { "filename": "users.js",
              "lineno": 255 } ],
        "docs":
          { "summary": "Blocks a member from logging into the site.",
            "description":
              [ "The `blockByEmail()` function returns a Promise that resolves when the",
                " specified user has been blocked.",
                "",
                " Pass the member's email address in the `email` parameter." ],
            "links": [],
            "examples":
              [ { "title": "Bloc a member using an email address",
                  "body":
                    [ "import wixUsers from 'wix-users-backend';",
                      "",
                      "export function myBackendFunction(email) {",
                      "  wixUsers.blockByEmail(email)",
                      "    .then( () => {",
                      "      // user has been blocked",
                      "    } );",
                      "  }",
                      "}" ] } ] },
        "extra":
          {  } },
      { "name": "register",
        "labels":
          [ "changed" ],
        "nameParams": [],
        "params":
          [ { "name": "email",
              "type": "string",
              "doc": "The email address to use when registering the user as a site member." },
            { "name": "password",
              "type": "string",
              "doc": "The password the newly added site member will use to log in." },
            { "name": "options",
              "type": "wix-users.RegistrationOptions",
              "doc": "Registration options.",
              "optional": true } ],
        "ret":
          { "type":
              { "name": "Promise",
                "typeParams":
                  [ "wix-users-backend.RegistrationResult" ] },
            "doc": "on fulfilled - When the user has been registered.\non rejected - Error message." },
        "locations":
          [ { "filename": "users.js",
              "lineno": 113 } ],
        "docs":
          { "summary": "Registers a new site member.",
            "description":
              [ "The `register()` function returns a Promise that resolves to a [`RegistrationResult`](#RegistrationResult)",
                " object when the user is either registered or is pending registration.",
                "",
                " If Site Members is [configured for automatic approval](https://support.wix.com/en/article/customizing-your-approval-settings-for-site-members),",
                " the `register()` function returns a status of `\"Active\"` and the user will",
                " be an active member of the site.",
                "",
                " If Site Members is [configured for manual approval](https://support.wix.com/en/article/customizing-your-approval-settings-for-site-members),",
                " the `register()` function returns a status of `\"Pending\"` and the user will",
                " be a pending member of the site. In order to activate a pending user, the",
                " site owner can [approve the user manually](https://support.wix.com/en/article/approving-a-site-member)",
                " using the Contacts application or you can call the [approveByToken()](wix-users-backend.html#approveByToken)",
                " or [approveByEmail()](wix-users-backend.html#approveByEmail) functions.",
                "",
                " The `sessionToken` returned when the new member is \"Active\" must be applied",
                " using the [`applySessionToken()`](wix-users.html#applySessionToken)",
                " function in client-side code to complete the user registration by logging",
                " in the registered user." ],
            "links": [],
            "examples":
              [ { "title": "Register a user using a 3rd party for approval",
                  "body":
                    [ "/*******************************",
                      " * backend code - register.jsw *",
                      " *******************************/",
                      "import wixUsers from 'wix-users-backend';",
                      "import {approveBy3rdParty} from 'some-backend-module';",
                      "",
                      "export function doRegistration(email, password, firstName, lastName) {",
                      "  // call a 3rd party API to check if the user is approved",
                      "  return approveBy3rdParty(email, password)",
                      "    .then( (isApproved) => {",
                      "      // if approved by 3rd party",
                      "      if (isApproved) {",
                      "        // register the user",
                      "        return wixUsers.register(email, password, {",
                      "          \"contactInfo\": {",
                      "            \"firstName\": firstName,",
                      "            \"lastName\": lastName",
                      "          }",
                      "        } )",
                      "        // user is now registered and pending approval",
                      "        // approve the user",
                      "          .then( (result) => wixUsers.approveByToken(result.approvalToken) )",
                      "          // user is now active, but not logged in",
                      "          // return the session token to log in the user client-side",
                      "          .then( (sessionToken) => {",
                      "            return {sessionToken, \"approved\": true};",
                      "          } );",
                      "      }",
                      "      // if not approved by 3rd party",
                      "      else {",
                      "        return {\"approved\": false};",
                      "      }",
                      "    } )",
                      "}",
                      "",
                      "/********************",
                      " * client-side code *",
                      " ********************/",
                      "import wixUsers from 'wix-users';",
                      "import {doRegistration} from 'backend/register';",
                      "",
                      "// ...",
                      "",
                      "let email = // the user's email addresses",
                      "let password = // the user's password",
                      "let firstName = // the user's first name",
                      "let lastName = // the user's last name",
                      "",
                      "doRegistration(email, password, firstName, lastName)",
                      "  .then( (result) => {",
                      "    if (result.approved)",
                      "    // log the user in",
                      "      wixUsers.applySessionToken(result.sessionToken);",
                      "    else {",
                      "      console.log(\"Not approved!\");",
                      "    }",
                      "  } );" ] },
                { "title": "Register a user sending an email for confirmation",
                  "body":
                    [ "/*******************************",
                      " * backend code - register.jsw *",
                      " *******************************/",
                      "import wixUsers from 'wix-users-backend';",
                      "import {sendEmailUsing3rdParty} from 'some-backend-module';",
                      "",
                      "export function doRegistration(email, password, firstName, lastName) {",
                      "  // register the user",
                      "  return wixUsers.register(email, password, {",
                      "    \"contactInfo\": {",
                      "      \"firstName\": firstName,",
                      "      \"lastName\": lastName",
                      "    }",
                      "  } )",
                      "    .then( (results) => {",
                      "      // user is now registered and pending approval",
                      "      // send a registration verification email",
                      "      return sendEmailUsing3rdParty('verify-registration', email,{",
                      "        \"name\": firstName,",
                      "        \"verifyLink\": `http://domain.com/post-register?token=${approvalToken}`",
                      "      } );",
                      "    } );",
                      "}",
                      "",
                      "export function doApproval(token) {",
                      "  // approve the user",
                      "  return wixUsers.approveByToken(token)",
                      "  // user is now active, but not logged in",
                      "  // return the session token to log in the user client-side",
                      "    .then( (sessionToken) => {",
                      "      return {sessionToken, \"approved\": true};",
                      "    } )",
                      "    .catch( (error) => {",
                      "      return {\"approved\": false, \"reason\": error};",
                      "    } );",
                      "}",
                      "",
                      "/*********************************",
                      " * client-side registration code *",
                      " *********************************/",
                      "import wixUsers from 'wix-users';",
                      "import {doRegistration} from 'backend/register';",
                      "",
                      "// ...",
                      "",
                      "let email = // the user's email address",
                      "let password = // the user's password",
                      "let firstName = // the user's first name",
                      "let lastName = // the user's last name",
                      "",
                      "doRegistration(email, password, firstName, lastName)",
                      "  .then( () => {",
                      "    console.log(\"Confirmation email sent.\");",
                      "  } );",
                      "",
                      "/**************************************",
                      " * client-side post-registration code *",
                      " **************************************/",
                      "import wixLocation from 'wix-location';",
                      "import {doApproval} from 'backend/register';",
                      "",
                      "$w.onReady( () => {",
                      "  // get the token from the URL",
                      "  let token = wixLocation.query.token;",
                      "",
                      "  doAppoval(token)",
                      "    .then( (result) => {",
                      "      if (result.approved)",
                      "        // log the user in",
                      "        wixUsers.applySessionToken(result.sessionToken);",
                      "      else",
                      "        console.log(\"Not approved!\");",
                      "    } );",
                      "}" ] } ] },
        "extra":
          { "notes":
              [ "When member registration is set to auto approve, calling the [client-side\n `register()` function](wix-users.html#register) is equally as secure as\n calling it from backend code. However, when member approval is set to\n manual, calling the backend version of the `register()` function allows you\n to construct more secure approval flows." ] } } ],
  "callbacks": [],
  "messages":
    [ { "name": "RegistrationResult",
        "locations":
          [ { "filename": "users.js",
              "lineno": 98 } ],
        "docs":
          { "summary": "An object that contains information about the results of a site registration.",
            "links": [],
            "examples": [] },
        "members":
          [ { "name": "status",
              "type": "string",
              "doc": "Registration status. Either \"Pending\" or \"Active\"." },
            { "name": "sessionToken",
              "type": "string",
              "doc": "A token used to log in the current\n user as a site member. Pass the token from your backend code to client-side\n code and use it when calling the [applySessionToken()](wix-users.html#applySessionToken)\n function. The token is only available when `status` is \"Active\".",
              "optional": true },
            { "name": "approvalToken",
              "type": "string",
              "doc": "A token for approving the user as\n a site member using the [approveByToken()](wix-users-backend.html#approveByToken)\n function. The token is safe to pass via email or from client-side code to\n backend code. The token is only available when `status` is \"Pending\".",
              "optional": true },
            { "name": "user",
              "type": "wix-users.User",
              "doc": "The user that has been registered." } ],
        "extra":
          {  },
        "labels":
          [ "changed" ] } ],
  "extra":
    { "notes":
        [ "The APIs in `wix-users` are only partially functional when previewing your site.\n View a published version of your site to see their complete functionality." ] } }